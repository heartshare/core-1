vault-test.silkky.cloud {
	import secureheader

	@vaultapi path /api* /identity* /icons* /notifications*

	route /admin* {
		authorize {
			set auth url https://admin.silkky.cloud/auth
			allow roles authp/admin
		}

		reverse_proxy http://vaultwarden:80
	}

	route /notifications/hub {
		uri strip_prefix /notifications/hub
		reverse_proxy http://vaultwarden:3012
	}

	handle @vaultapi {
		reverse_proxy http://vaultwarden:80
	}

	handle {
		header {
			Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://haveibeenpwned.com https://www.gravatar.com; child-src 'self' https://*.duosecurity.com https://*.duofederal.com; frame-src 'self' https://*.duosecurity.com https://*.duofederal.com; connect-src 'self' https://api.pwnedpasswords.com https://twofactorauth.org https://2fa.directory; object-src 'self' blob:;"
		}

		reverse_proxy http://vaultwarden-web:80
	}
}
